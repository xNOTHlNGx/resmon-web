<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Info</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            color: #333;
        }
        .info-section {
            margin: 10px 0;
        }
        .info-section strong {
            display: inline-block;
            width: 150px;
            color: #555;
        }
    </style>
</head>
<body>
    <h1>System Info</h1>
    <div class="info-section">
        <strong>Used Memory:</strong> <span id="used-memory">0 KB</span><br>
        <strong>Available Memory:</strong> <span id="available-memory">0 KB</span><br>
        <strong>Total Memory:</strong> <span id="total-memory">0 KB</span><br>
        <strong>Free Memory:</strong> <span id="free-memory">0 KB</span><br>
        <strong>Cached Memory:</strong> <span id="cached-memory">0 KB</span>
    </div>
    <div class="info-section">
        <strong>CPU Usage:</strong> <span id="cpu-usage">0%</span>
    </div>

    <script>
        // Function to convert KB to GB if KB > 1024
        const convertToGB = (kb) => {
            if (kb >= 1024 * 1024) {
                return (kb / 1024 / 1024).toFixed(2) + " GB"; // Convert KB to GB
            } else {
                return (kb / 1024).toFixed(2) + " MB"; // Convert KB to MB
            }
        };

        // Memory Info SSE
        const memInfoSource = new EventSource('/sse/meminfo');
        memInfoSource.onmessage = function (event) {
            const memInfo = JSON.parse(event.data);

            // Update memory information
            document.getElementById('used-memory').textContent = convertToGB(memInfo.memUsedKb);
            document.getElementById('available-memory').textContent = convertToGB(memInfo.memAvailableKb);
            document.getElementById('total-memory').textContent = convertToGB(memInfo.memTotalKb);
            document.getElementById('free-memory').textContent = convertToGB(memInfo.memFreeKb);
            document.getElementById('cached-memory').textContent = convertToGB(memInfo.memCachedKb);
        };

        memInfoSource.onerror = function (error) {
            console.error('Memory SSE connection error:', error);
            memInfoSource.close();
        };

        // CPU Usage SSE
        const cpuInfoSource = new EventSource('/sse/cpuinfo');
        cpuInfoSource.onmessage = function (event) {
            const cpuInfo = JSON.parse(event.data);

            // Update CPU usage
            document.getElementById('cpu-usage').textContent = cpuInfo.cpuUsage;
        };

        cpuInfoSource.onerror = function (error) {
            console.error('CPU SSE connection error:', error);
            cpuInfoSource.close();
        };
    </script>
</body>
</html>
