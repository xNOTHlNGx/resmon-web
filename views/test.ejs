<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Memory Info</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            color: #333;
        }
        .mem-info {
            margin: 10px 0;
        }
        .mem-info strong {
            display: inline-block;
            width: 150px;
            color: #555;
        }
    </style>
</head>
<body>
    <h1>Memory Info</h1>
    <div class="mem-info">
        <strong>Used Memory:</strong> <span id="used-memory">0 KB</span>
        <strong>Available Memory:</strong> <span id="available-memory">0 KB</span>
        <strong>Total Memory:</strong> <span id="total-memory">0 KB</span>
        <strong>Free Memory:</strong> <span id="free-memory">0 KB</span>
        <strong>Cached Memory:</strong> <span id="cached-memory">0 KB</span>
    </div>

    <script>
        // Function to convert KB to GB if KB > 1024
        const convertToGB = (kb) => {
            if (kb >= 1024) {
                return (kb / 1024 / 1024).toFixed(2) + " GB"; // Convert KB to GB
            } else {
                return kb + " KB"; // If less than 1024 KB, just return KB
            }
        };

        // Set up SSE connection
        const eventSource = new EventSource('/sse/meminfo');
        eventSource.onmessage = function (event) {
            const memInfo = JSON.parse(event.data);

            // Log incoming data for debugging
            console.log(memInfo);

            // Convert the memory values and display them
            document.getElementById('used-memory').textContent = convertToGB(memInfo.memUsedKb);
            document.getElementById('available-memory').textContent = convertToGB(memInfo.memAvailableKb);
            document.getElementById('total-memory').textContent = convertToGB(memInfo.memTotalKb);
            document.getElementById('free-memory').textContent = convertToGB(memInfo.memFreeKb);
            document.getElementById('cached-memory').textContent = convertToGB(memInfo.memCachedKb);
        };

        eventSource.onerror = function (error) {
            console.error('SSE connection error:', error);
            eventSource.close();
        };
    </script>

</body>
</html>
